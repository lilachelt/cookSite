
<!DOCTYPE html>
<html>
<head>
    <title>{{title}}</title>
    <link rel="stylesheet" href="stylesheets/noResult.css">
    <script type="application/javascript" src="js/jquery-1.12.4.min.js"></script>
</head>
<body >

<div id="container">
    <form action="" id="theForm" method="post">

        <div id="logo_searchline_wrapper">
            <div>
                <a href ="http://www.cookit.co.il/" > <img id="logo" src="images\logo.jpg"> </a>
            </div>
        </div>

            <div id="myProgressBar">
                <div id="myBar">
                    <div id="noResultsPercent"></div>
                </div>
            </div>
            <div id="noResults" type="hidden">
              </div>
            <div class="inline_display">
                <input type="hidden" id="isContinueSearch" name="isContinueSearch" value="{{isContinueSearch}}" />
                <input type="hidden" id="searchLine" name="search" value="{{searchString}}" />
            </div>
            <div id = "endSearch">{{noResults}} </div>

    </form>
 </div>

<script>
    var stopTimeOut = setTimeout(doSearch, 100);
    var retries = 0;
    function doSearch() {

        clearTimeout(stopTimeOut);
        if (document.getElementById("isContinueSearch").value == "yes") {
            var postData = $('#theForm').serialize();
            var formURL = $('#theForm').attr("action");
            $.ajax(
                    {
                        url: formURL,
                        type: "POST",
                        data: postData,
                        success: function (data, textStatus, jqXHR) {
                            if (data.isSuccess == "false")
                            {
                                retries++;
                                if (retries == 5)
                                {
                                    // Not success
                                    $("#myBar").hide();
                                    $("#endSearch").append("מצטערים, לא נמצאו תוצאות. אנא נסה במועד מאוחר יותר ");
                                    setTimeout(function(){
                                        window.location = '/';
                                    }, 5000);

                                }
                                else {
                                    widthElem=$("#myBar").width();
                                    $("#myBar").load (move(widthElem));
                                    stopTimeOut = setTimeout(doSearch, 10000);
                                }
                            }
                            else
                            {
                                document.open();
                                document.write(data);
                                document.close();
                            }
                            //data: return data from server
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            //if fails
                        }
                    });
        }
    }
</script>


<script>
    function move(widthElem) {
        var elem = document.getElementById("myBar");
        var width = widthElem;
        var id = setInterval(frame, 1000);
        function frame() {
            if (width >= 100) {
                clearInterval(id);
            } else {
                width=width+2;
                elem.style.width = width + '%';
                document.getElementById("noResultsPercent").innerHTML = width * 1  + '%';
            }
        }
    }
</script>




</body>
</html>